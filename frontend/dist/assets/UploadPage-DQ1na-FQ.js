import{q as h,r as i,U as b,j as e}from"./index-Tbe7IPkS.js";import"whatwg-fetch";async function w(a,d=null){const l=new FormData;l.append("gedcom_file",a),l.append("tree_name",a.name);try{return(await h.post("/api/upload",l,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:d??void 0})).data}catch(t){throw console.error("üî• GEDCOM Upload Error:",t),t}}function U(){const[a,d]=i.useState(null),[l,t]=i.useState(""),[x,u]=i.useState(null),p=i.useRef(null),{setStatus:r,setVisible:m}=i.useContext(b),f=c=>{const s=c.target.files[0];s&&s.name.endsWith(".ged")?(d(s),t("")):(d(null),t("‚ùå Please select a `.ged` file."))},g=async()=>{var c;if(!a||!a.name.endsWith(".ged")){t("‚ùå Please select a `.ged` file first.");return}t("‚è≥ Uploading..."),m(!0),r("üì§ Uploading GEDCOM file...");try{const s=await w(a);r("üß¨ Parsing & saving tree..."),await new Promise(o=>setTimeout(o,1e3)),r("üåç Geocoding locations..."),await new Promise(o=>setTimeout(o,1e3)),r("‚úÖ Upload complete!"),setTimeout(()=>m(!1),1500),u(s.data),t("‚úÖ Upload successful!")}catch(s){r("‚ùå Upload failed."),setTimeout(()=>m(!1),1500);let o="";try{const n=JSON.parse((c=s.request)==null?void 0:c.responseText);o=(n==null?void 0:n.trace)||""}catch(n){console.warn("‚ö†Ô∏è Could not parse backend trace:",n)}t(`‚ùå Upload failed: ${s.message}`),console.error("‚ùå Upload error:",s)}};return e.jsxs("main",{className:"flex flex-col items-center justify-start px-6 pt-16 pb-24 text-text max-w-3xl mx-auto",children:[e.jsx("h2",{className:"text-3xl md:text-4xl font-display font-semibold text-text mb-4 text-center",children:"Upload GEDCOM File"}),e.jsx("p",{className:"text-dim text-sm mb-8 text-center",children:"Select a `.ged` file to start mapping your family‚Äôs journey."}),e.jsxs("div",{className:"w-full bg-surface rounded-xl border border-border p-6 shadow-md",children:[e.jsxs("div",{className:"flex flex-col items-center gap-4 w-full",children:[e.jsx("button",{onClick:()=>p.current.click(),className:"w-full max-w-xs px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 text-white text-sm font-semibold tracking-wide transition-all backdrop-blur border border-white/20 shadow-md",children:a?`üìÑ ${a.name}`:"üìÇ Choose .ged File"}),e.jsx("input",{ref:p,type:"file",accept:".ged",onChange:f,className:"hidden"}),e.jsx("button",{onClick:g,className:"w-full max-w-xs px-4 py-2 rounded-lg bg-yellow-400 hover:bg-yellow-300 text-black text-sm font-bold tracking-wide transition-all shadow-md",children:"Upload"})]}),l&&e.jsx("div",{className:`mt-6 text-sm px-4 py-3 rounded-md flex items-center gap-2
              ${l.startsWith("‚úÖ")?"bg-green-800 text-green-200":l.startsWith("‚ùå")?"bg-red-800 text-red-300":"bg-zinc-800 text-white"}`,children:l}),x&&e.jsxs("div",{className:"mt-6 text-sm bg-zinc-900 rounded-lg p-4 border border-zinc-700 overflow-x-auto",children:[e.jsx("h3",{className:"font-bold mb-2 text-accent",children:"Response:"}),e.jsx("pre",{className:"text-xs text-green-400",children:JSON.stringify(x,null,2)})]})]})]})}export{U as default};
