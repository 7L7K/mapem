import{r as d,U as h,j as t}from"./index-ca53c5cd.js";async function w(s,m=null){const o=new FormData;o.append("file",s),console.log("üì§ Uploading GEDCOM:",s.name,`${(s.size/1024).toFixed(1)} KB`);try{const e=await fetch("/api/upload/",{method:"POST",body:o});if(!e.ok){const x=await e.text();let r="";try{const a=JSON.parse(x);r=(a==null?void 0:a.trace)||""}catch{r=x}throw console.error("‚ùå Upload failed:",e.status,r),new Error(`Upload failed: ${e.status}
${r}`)}const c=await e.json();return console.log("‚úÖ Upload successful:",c),c}catch(e){throw console.error("üî• GEDCOM Upload Error:",e),e}}function y(){const[s,m]=d.useState(null),[o,e]=d.useState(""),[c,x]=d.useState(null),r=d.useRef(null),{setStatus:a,setVisible:p}=d.useContext(h),f=u=>{const l=u.target.files[0];l&&l.name.endsWith(".ged")?(m(l),e("")):(m(null),e("‚ùå Please select a `.ged` file."))},g=async()=>{var u;if(!s||!s.name.endsWith(".ged")){e("‚ùå Please select a `.ged` file first.");return}e("‚è≥ Uploading..."),p(!0),a("üì§ Uploading GEDCOM file...");try{const l=await w(s);a("üß¨ Parsing & saving tree..."),await new Promise(n=>setTimeout(n,1e3)),a("üåç Geocoding locations..."),await new Promise(n=>setTimeout(n,1e3)),a("‚úÖ Upload complete!"),setTimeout(()=>p(!1),1500),x(l.data),e("‚úÖ Upload successful!")}catch(l){a("‚ùå Upload failed."),setTimeout(()=>p(!1),1500);let n="";try{const i=JSON.parse((u=l.request)==null?void 0:u.responseText);n=(i==null?void 0:i.trace)||"",console.log(`üß† Backend Trace:
`,n)}catch(i){console.warn("‚ö†Ô∏è Could not parse backend trace:",i)}e(`‚ùå Upload failed: ${l.message}`),console.error("‚ùå Upload error:",l)}};return t.jsxs("main",{className:"flex flex-col items-center justify-start px-6 pt-16 pb-24 text-text max-w-3xl mx-auto",children:[t.jsx("h2",{className:"text-3xl md:text-4xl font-display font-semibold text-text mb-4 text-center",children:"Upload GEDCOM File"}),t.jsx("p",{className:"text-dim text-sm mb-8 text-center",children:"Select a `.ged` file to start mapping your family‚Äôs journey."}),t.jsxs("div",{className:"w-full bg-surface rounded-xl border border-border p-6 shadow-md",children:[t.jsxs("div",{className:"flex flex-col items-center gap-4 w-full",children:[t.jsx("button",{onClick:()=>r.current.click(),className:"w-full max-w-xs px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 text-white text-sm font-semibold tracking-wide transition-all backdrop-blur border border-white/20 shadow-md",children:s?`üìÑ ${s.name}`:"üìÇ Choose .ged File"}),t.jsx("input",{ref:r,type:"file",accept:".ged",onChange:f,className:"hidden"}),t.jsx("button",{onClick:g,className:"w-full max-w-xs px-4 py-2 rounded-lg bg-yellow-400 hover:bg-yellow-300 text-black text-sm font-bold tracking-wide transition-all shadow-md",children:"Upload"})]}),o&&t.jsx("div",{className:`mt-6 text-sm px-4 py-3 rounded-md flex items-center gap-2
              ${o.startsWith("‚úÖ")?"bg-green-800 text-green-200":o.startsWith("‚ùå")?"bg-red-800 text-red-300":"bg-zinc-800 text-white"}`,children:o}),c&&t.jsxs("div",{className:"mt-6 text-sm bg-zinc-900 rounded-lg p-4 border border-zinc-700 overflow-x-auto",children:[t.jsx("h3",{className:"font-bold mb-2 text-accent",children:"Response:"}),t.jsx("pre",{className:"text-xs text-green-400",children:JSON.stringify(c,null,2)})]})]})]})}export{y as default};
